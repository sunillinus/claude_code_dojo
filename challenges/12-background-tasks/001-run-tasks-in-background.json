{
  "id": "12-001",
  "module": "background-tasks",
  "title": "Run Tasks in Background",
  "description": "Learn how Claude Code's `run_in_background` parameter lets you launch tasks asynchronously, then practice by running scripts in the background and fixing lint issues.\n\n## What Does \"Background\" Mean?\n\nWhen Claude Code runs a command normally, it **blocks** -- it waits for the command to finish before doing anything else. With background execution, the command launches and Claude Code **immediately gets control back**.\n\n```\nBlocking (default):     [Run build ~~~~~~~~ Done] [Continue work...]\nBackground:             [Launch build] [Continue work...] [Check result]\n                                       ^^^^^^^^^^^^^^^^^\n                                       Work happens WHILE build runs\n```\n\n## The `run_in_background` Parameter\n\nThe Bash tool accepts `run_in_background: true`. When used:\n1. The command starts in a separate process\n2. Claude Code receives a **task ID** and **output file path** immediately\n3. Claude Code continues with the next action\n4. The command's output is written to the output file\n5. Results can be checked later\n\nThe Task tool (subagents) also supports `run_in_background` -- the subagent runs independently while the main conversation continues.\n\n## Checking Results Later\n\n| Method | How | Best For |\n|--------|-----|----------|\n| **TaskOutput** (non-blocking) | `block: false` | Quick \"is it done?\" check |\n| **TaskOutput** (blocking) | `block: true` | Wait for completion |\n| **Read tool** | Read the output file path | Full output history |\n| **tail via Bash** | `tail -20 /path/to/output` | Quick peek at recent output |\n\n## When to Use Background\n\nThe key question: **Does your next action depend on this command's result?**\n- If YES -> use blocking (the default)\n- If NO -> use background and keep working\n\nGood candidates: builds, test suites, linting, doc generation, research subagents.\nBad candidates: file reads you need immediately, directory creation before file creation.\n\n## Your Exercise\n\nThis project has **3 independent scripts**: test (`test/run-tests.js`), lint (`scripts/lint.js`), and docs (`scripts/build-docs.js`). None depend on each other.\n\nThe linter will find issues -- some source files use `var` instead of `const`/`let`.\n\n**Your task:**\n1. Run all 3 scripts (test, lint, docs) -- ideally in the background so they execute simultaneously\n2. Check the lint output to see what warnings were found\n3. Fix the lint warnings in the source files (replace `var` with `const` or `let`)\n4. Verify that `docs/api.md` was generated by the docs script\n\nRun `/dojo check` when done.",
  "difficulty": "intermediate",
  "xpReward": 200,
  "estimatedMinutes": 12,
  "skills": ["background-execution", "async-workflows", "lint-fixing"],

  "setup": {
    "workingDir": "~/dojo-workspace/challenge-12-001",
    "initialFiles": [
      {
        "path": "README.md",
        "content": "# Multi-Task Project\n\nA project with independent test, lint, and documentation scripts.\n\n## Scripts\n\n- `npm run test` — Run test suite\n- `npm run lint` — Lint source files\n- `npm run docs` — Generate API documentation\n"
      },
      {
        "path": "package.json",
        "content": "{\n  \"name\": \"multi-task-project\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"test\": \"node test/run-tests.js\",\n    \"lint\": \"node scripts/lint.js\",\n    \"docs\": \"node scripts/build-docs.js\"\n  }\n}\n"
      },
      {
        "path": "src/math.js",
        "content": "/**\n * Add two numbers\n * @param {number} a\n * @param {number} b\n * @returns {number}\n */\nfunction add(a, b) {\n  var result = a + b;\n  return result;\n}\n\n/**\n * Subtract two numbers\n * @param {number} a\n * @param {number} b\n * @returns {number}\n */\nfunction subtract(a, b) {\n  return a - b;\n}\n\n/**\n * Multiply two numbers\n * @param {number} a\n * @param {number} b\n * @returns {number}\n */\nfunction multiply(a, b) {\n  var product = a * b;\n  return product;\n}\n\nmodule.exports = { add, subtract, multiply };\n"
      },
      {
        "path": "src/strings.js",
        "content": "/**\n * Capitalize the first letter of a string\n * @param {string} str\n * @returns {string}\n */\nfunction capitalize(str) {\n  if (!str) return '';\n  var first = str.charAt(0).toUpperCase();\n  return first + str.slice(1);\n}\n\n/**\n * Reverse a string\n * @param {string} str\n * @returns {string}\n */\nfunction reverse(str) {\n  return str.split('').reverse().join('');\n}\n\n/**\n * Truncate a string to a given length with ellipsis\n * @param {string} str\n * @param {number} maxLength\n * @returns {string}\n */\nfunction truncate(str, maxLength) {\n  if (str.length <= maxLength) return str;\n  return str.slice(0, maxLength - 3) + '...';\n}\n\nmodule.exports = { capitalize, reverse, truncate };\n"
      },
      {
        "path": "src/arrays.js",
        "content": "/**\n * Return unique elements from an array\n * @param {Array} arr\n * @returns {Array}\n */\nfunction unique(arr) {\n  return [...new Set(arr)];\n}\n\n/**\n * Chunk an array into groups of a given size\n * @param {Array} arr\n * @param {number} size\n * @returns {Array<Array>}\n */\nfunction chunk(arr, size) {\n  const result = [];\n  for (let i = 0; i < arr.length; i += size) {\n    result.push(arr.slice(i, i + size));\n  }\n  return result;\n}\n\n/**\n * Flatten a nested array one level deep\n * @param {Array} arr\n * @returns {Array}\n */\nfunction flatten(arr) {\n  return arr.reduce((acc, item) => acc.concat(item), []);\n}\n\nmodule.exports = { unique, chunk, flatten };\n"
      },
      {
        "path": "test/run-tests.js",
        "content": "const { add, subtract, multiply } = require('../src/math');\nconst { capitalize, reverse, truncate } = require('../src/strings');\nconst { unique, chunk, flatten } = require('../src/arrays');\n\nlet passed = 0;\nlet failed = 0;\n\nfunction assert(condition, message) {\n  if (condition) {\n    passed++;\n    console.log(`  PASS: ${message}`);\n  } else {\n    failed++;\n    console.log(`  FAIL: ${message}`);\n  }\n}\n\nconsole.log('Running math tests...');\nassert(add(2, 3) === 5, 'add(2, 3) === 5');\nassert(subtract(5, 3) === 2, 'subtract(5, 3) === 2');\nassert(multiply(4, 3) === 12, 'multiply(4, 3) === 12');\n\nconsole.log('Running string tests...');\nassert(capitalize('hello') === 'Hello', 'capitalize(\"hello\") === \"Hello\"');\nassert(reverse('abc') === 'cba', 'reverse(\"abc\") === \"cba\"');\nassert(truncate('hello world', 8) === 'hello...', 'truncate with ellipsis');\n\nconsole.log('Running array tests...');\nassert(JSON.stringify(unique([1,2,2,3])) === '[1,2,3]', 'unique removes duplicates');\nassert(JSON.stringify(chunk([1,2,3,4], 2)) === '[[1,2],[3,4]]', 'chunk splits correctly');\nassert(JSON.stringify(flatten([[1,2],[3,4]])) === '[1,2,3,4]', 'flatten works');\n\nconsole.log(`\\nResults: ${passed} passed, ${failed} failed`);\nprocess.exit(failed > 0 ? 1 : 0);\n"
      },
      {
        "path": "scripts/lint.js",
        "content": "const fs = require('fs');\nconst path = require('path');\n\nconst srcDir = path.join(__dirname, '..', 'src');\nlet warnings = 0;\nlet files = 0;\n\nconsole.log('Linting source files...');\n\nconst srcFiles = fs.readdirSync(srcDir).filter(f => f.endsWith('.js'));\nsrcFiles.forEach(file => {\n  files++;\n  const content = fs.readFileSync(path.join(srcDir, file), 'utf-8');\n  const lines = content.split('\\n');\n  console.log(`  Checking ${file}...`);\n  \n  lines.forEach((line, i) => {\n    if (line.length > 100) {\n      warnings++;\n      console.log(`    Line ${i + 1}: line exceeds 100 characters`);\n    }\n    if (line.includes('var ')) {\n      warnings++;\n      console.log(`    Line ${i + 1}: use 'let' or 'const' instead of 'var'`);\n    }\n  });\n});\n\nconsole.log(`\\nLint complete: ${files} files checked, ${warnings} warnings`);\n"
      },
      {
        "path": "scripts/build-docs.js",
        "content": "const fs = require('fs');\nconst path = require('path');\n\nconst srcDir = path.join(__dirname, '..', 'src');\nconst docsDir = path.join(__dirname, '..', 'docs');\n\nif (!fs.existsSync(docsDir)) {\n  fs.mkdirSync(docsDir, { recursive: true });\n}\n\nconsole.log('Building documentation...');\n\nconst srcFiles = fs.readdirSync(srcDir).filter(f => f.endsWith('.js'));\nlet allDocs = '# API Documentation\\n\\n';\n\nsrcFiles.forEach(file => {\n  console.log(`  Processing ${file}...`);\n  const content = fs.readFileSync(path.join(srcDir, file), 'utf-8');\n  const moduleName = path.basename(file, '.js');\n  allDocs += `## ${moduleName}\\n\\n`;\n  \n  const jsdocPattern = /\\/\\*\\*([\\s\\S]*?)\\*\\/\\s*function\\s+(\\w+)/g;\n  let match;\n  while ((match = jsdocPattern.exec(content)) !== null) {\n    const [, docBlock, funcName] = match;\n    allDocs += `### ${funcName}\\n\\n`;\n    const cleanDoc = docBlock.split('\\n').map(l => l.replace(/^\\s*\\*\\s?/, '')).join('\\n').trim();\n    allDocs += cleanDoc + '\\n\\n';\n  }\n});\n\nfs.writeFileSync(path.join(docsDir, 'api.md'), allDocs);\nconsole.log(`\\nDocumentation written to docs/api.md`);\n"
      }
    ],
    "cleanBefore": true
  },

  "objectives": [
    {
      "id": "obj-1",
      "description": "Documentation generated (docs/api.md exists from build-docs.js)",
      "type": "file_exists",
      "target": "docs/api.md",
      "required": true
    },
    {
      "id": "obj-2",
      "description": "Lint issues fixed in src/math.js (no var declarations)",
      "type": "file_not_contains",
      "target": "src/math.js",
      "pattern": "var ",
      "required": true
    },
    {
      "id": "obj-3",
      "description": "Lint issues fixed in src/strings.js (no var declarations)",
      "type": "file_not_contains",
      "target": "src/strings.js",
      "pattern": "var ",
      "required": true
    }
  ],

  "bonusObjectives": [
    {
      "id": "bonus-1",
      "description": "Used const (not let) for the replacements since the values don't change",
      "type": "file_contains",
      "target": "src/math.js",
      "pattern": "const result|const product",
      "xpBonus": 40
    }
  ],

  "hints": [
    {
      "level": 1,
      "text": "Ask Claude to run all 3 scripts: 'Run npm run test, npm run lint, and npm run docs -- run them in the background since they're independent.' Then check the lint output to see what warnings were found.",
      "xpCost": 15
    },
    {
      "level": 2,
      "text": "The linter finds 'var' usage in src/math.js (var result, var product) and src/strings.js (var first). Replace each 'var' with 'const' since the values aren't reassigned. Also make sure the docs script ran and created docs/api.md.",
      "xpCost": 40
    },
    {
      "level": 3,
      "text": "Steps: (1) Run 'node scripts/build-docs.js' to generate docs/api.md. (2) Run 'node scripts/lint.js' to see warnings. (3) In src/math.js, change 'var result' to 'const result' and 'var product' to 'const product'. (4) In src/strings.js, change 'var first' to 'const first'. (5) Run /dojo check.",
      "xpCost": 80
    }
  ],

  "solution": {
    "approach": "Run all 3 scripts (ideally in background), check lint output for warnings, fix the var declarations in math.js and strings.js, verify docs/api.md was generated.",
    "example": "Run scripts in background, find 'var' warnings in lint output, replace var with const in math.js and strings.js.",
    "alternativeApproaches": [
      "Run scripts sequentially instead of in background (works but slower)",
      "Fix the var issues first based on reading the files, then run lint to verify"
    ]
  },

  "learningPoints": [
    "The run_in_background parameter launches commands asynchronously -- you get a task ID and output file back immediately",
    "Background tasks are ideal for independent, long-running processes like builds, tests, and linting",
    "Use TaskOutput (block: false for status check, block: true to wait) or Read the output file to check results",
    "The critical decision: if your next step depends on this command's result, use blocking; if not, use background",
    "Multiple independent background tasks can run simultaneously, reducing total workflow time"
  ],

  "nextChallenge": "12-002"
}
