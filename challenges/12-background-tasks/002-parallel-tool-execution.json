{
  "id": "12-002",
  "module": "background-tasks",
  "title": "Parallel Tool Execution",
  "description": "Learn how Claude Code calls multiple tools simultaneously when operations are independent, then practice by merging config files and adding module identifiers in parallel.\n\n## What Is Parallel Tool Execution?\n\nWhen Claude Code needs multiple actions, it can do them **one at a time** (sequential) or **all at once** (parallel). Parallel is possible when operations don't depend on each other's results.\n\n```\nSequential:   [Read file A] --> [Read file B] --> [Read file C]  ~3x time\nParallel:     [Read file A]\n              [Read file B]    <-- all at once                  ~1x time\n              [Read file C]\n```\n\nThis is different from background execution (Challenge 12-001). Background runs one long command asynchronously. Parallel executes multiple tool calls in the same response.\n\n## The Independence Rule\n\nTwo operations are **independent** when:\n- Neither needs the other's result to start\n- Neither modifies something the other reads\n- The order doesn't matter for correctness\n\nTwo operations are **dependent** when:\n- The second needs the first's output (read then edit)\n- Both modify the same file (write-write conflict)\n- One creates something the other needs (mkdir before create file)\n\n## Parallelizable Examples\n\n| Operations | Why Safe |\n|------------|----------|\n| Read file A, Read file B, Read file C | Independent reads |\n| Grep for \"TODO\", Grep for \"FIXME\" | Independent searches |\n| Run tests for module A, module B | Separate test suites |\n| Create /src/header.js, Create /src/footer.js | Different files |\n\n## NOT Parallelizable\n\n| Operations | Why Sequential |\n|------------|----------------|\n| Read file -> Edit that file | Must read before editing |\n| mkdir /src -> Create /src/app.js | Directory must exist first |\n| npm install -> npm run build | Build needs packages |\n| Search for pattern -> Fix matches | Must find before fixing |\n\n## Performance Benefit\n\n3 parallel reads take ~1x time. 3 sequential reads take ~3x time. The savings compound with more independent operations.\n\n## Your Exercise\n\nThis project has **3 config files** (`config/database.json`, `config/server.json`, `config/auth.json`) and **3 source modules** (`src/auth/login.js`, `src/api/users.js`, `src/utils/validation.js`).\n\n**Your task:**\n1. Read all 3 config files (these can be read in parallel) and merge them into a single `config/combined.json` that contains all settings\n2. Add a module identifier comment to the top of each source file:\n   - `src/auth/login.js` -> `// Auth module`\n   - `src/api/users.js` -> `// API module`\n   - `src/utils/validation.js` -> `// Utils module`\n\nBoth tasks involve independent operations that can be parallelized.\n\nRun `/dojo check` when done.",
  "difficulty": "intermediate",
  "xpReward": 225,
  "estimatedMinutes": 12,
  "skills": ["parallel-execution", "config-management", "dependency-analysis"],

  "setup": {
    "workingDir": "~/dojo-workspace/challenge-12-002",
    "initialFiles": [
      {
        "path": "README.md",
        "content": "# Web Application\n\nA multi-module web application with separate configuration files.\n\n## Structure\n\n- `config/` — Configuration files (database, server, auth)\n- `src/auth/` — Authentication module\n- `src/api/` — API endpoints\n- `src/utils/` — Utility functions\n"
      },
      {
        "path": "package.json",
        "content": "{\n  \"name\": \"webapp-project\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"test\": \"node test/run-all.js\",\n    \"lint\": \"echo 'Linting...' && node scripts/lint.js\",\n    \"build\": \"echo 'Building...' && sleep 2 && echo 'Done'\"\n  }\n}\n"
      },
      {
        "path": "config/database.json",
        "content": "{\n  \"host\": \"localhost\",\n  \"port\": 5432,\n  \"database\": \"webapp_dev\",\n  \"pool\": {\n    \"min\": 2,\n    \"max\": 10\n  }\n}\n"
      },
      {
        "path": "config/server.json",
        "content": "{\n  \"port\": 3000,\n  \"host\": \"0.0.0.0\",\n  \"cors\": {\n    \"origin\": \"http://localhost:8080\",\n    \"methods\": [\"GET\", \"POST\", \"PUT\", \"DELETE\"]\n  },\n  \"rateLimit\": {\n    \"windowMs\": 900000,\n    \"max\": 100\n  }\n}\n"
      },
      {
        "path": "config/auth.json",
        "content": "{\n  \"jwtExpiry\": \"24h\",\n  \"bcryptRounds\": 12,\n  \"sessionTimeout\": 3600,\n  \"maxLoginAttempts\": 5\n}\n"
      },
      {
        "path": "src/auth/login.js",
        "content": "const bcrypt = require('bcrypt');\nconst jwt = require('jsonwebtoken');\n\nasync function login(email, password, db, config) {\n  const user = await db.findUserByEmail(email);\n  if (!user) throw new Error('User not found');\n  \n  const valid = await bcrypt.compare(password, user.passwordHash);\n  if (!valid) throw new Error('Invalid password');\n  \n  const token = jwt.sign(\n    { id: user.id, email: user.email, role: user.role },\n    config.jwtSecret,\n    { expiresIn: config.jwtExpiry }\n  );\n  \n  return { token, user: { id: user.id, email: user.email } };\n}\n\nmodule.exports = { login };\n"
      },
      {
        "path": "src/api/users.js",
        "content": "async function getUsers(db) {\n  return db.query('SELECT id, name, email FROM users');\n}\n\nasync function getUserById(db, id) {\n  const user = await db.query('SELECT * FROM users WHERE id = $1', [id]);\n  if (!user) throw new Error('User not found');\n  return user;\n}\n\nasync function updateUser(db, id, updates) {\n  return db.query('UPDATE users SET name = $1 WHERE id = $2', [updates.name, id]);\n}\n\nmodule.exports = { getUsers, getUserById, updateUser };\n"
      },
      {
        "path": "src/utils/validation.js",
        "content": "function validateEmail(email) {\n  const pattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return pattern.test(email);\n}\n\nfunction validatePassword(password) {\n  return password && password.length >= 8;\n}\n\nfunction sanitizeInput(str) {\n  return str.replace(/[<>\"'&]/g, '');\n}\n\nmodule.exports = { validateEmail, validatePassword, sanitizeInput };\n"
      }
    ],
    "cleanBefore": true
  },

  "objectives": [
    {
      "id": "obj-1",
      "description": "Combined config file exists",
      "type": "file_exists",
      "target": "config/combined.json",
      "required": true
    },
    {
      "id": "obj-2",
      "description": "Combined config contains settings from all 3 config files",
      "type": "file_contains",
      "target": "config/combined.json",
      "pattern": "database|server|auth",
      "required": true
    },
    {
      "id": "obj-3",
      "description": "Auth module has module identifier comment",
      "type": "file_contains",
      "target": "src/auth/login.js",
      "pattern": "// Auth module|// Module: auth|@module auth",
      "required": true
    },
    {
      "id": "obj-4",
      "description": "API module has module identifier comment",
      "type": "file_contains",
      "target": "src/api/users.js",
      "pattern": "// API module|// Module: api|@module api",
      "required": true
    }
  ],

  "bonusObjectives": [
    {
      "id": "bonus-1",
      "description": "Utils module also has identifier comment",
      "type": "file_contains",
      "target": "src/utils/validation.js",
      "pattern": "// Utils module|// Module: utils|@module utils",
      "xpBonus": 40
    }
  ],

  "hints": [
    {
      "level": 1,
      "text": "Ask Claude to read all 3 config files at once (parallel reads), then merge them into config/combined.json. Then ask it to add module identifier comments to the top of each source file.",
      "xpCost": 15
    },
    {
      "level": 2,
      "text": "For the combined config, structure it as: { \"database\": { ...database.json contents }, \"server\": { ...server.json contents }, \"auth\": { ...auth.json contents } }. For module identifiers, add '// Auth module' as the first line of src/auth/login.js, '// API module' for src/api/users.js, and '// Utils module' for src/utils/validation.js.",
      "xpCost": 45
    },
    {
      "level": 3,
      "text": "Ask Claude: 'Read config/database.json, config/server.json, and config/auth.json. Create config/combined.json that merges all 3 under keys \"database\", \"server\", and \"auth\". Then add a comment \"// Auth module\" to the top of src/auth/login.js, \"// API module\" to src/api/users.js, and \"// Utils module\" to src/utils/validation.js.'",
      "xpCost": 90
    }
  ],

  "solution": {
    "approach": "Read all 3 config files in parallel, merge into combined.json under database/server/auth keys, then add module identifier comments to all 3 source files.",
    "example": "Read configs in parallel, create combined.json with nested structure, add // Auth module, // API module, // Utils module comments.",
    "alternativeApproaches": [
      "Read configs one at a time and merge incrementally",
      "Write a Node.js script that reads and merges the configs programmatically"
    ]
  },

  "learningPoints": [
    "Parallel tool execution sends multiple tool calls in one response -- they all run simultaneously",
    "Operations are parallelizable when they are independent: neither needs the other's result",
    "Common parallel patterns: reading multiple files, searching for different patterns, editing independent files",
    "Operations with data dependencies (read-then-edit same file) must remain sequential",
    "Parallel tool calls are different from background execution -- parallel is multiple tools at once, background is one long task running asynchronously"
  ],

  "nextChallenge": "12-003"
}
