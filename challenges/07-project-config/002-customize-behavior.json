{
  "id": "07-002",
  "module": "project-config",
  "title": "Customize Claude's Behavior",
  "description": "Learn to write behavioral rules in CLAUDE.md that control how Claude Code writes code: coding style, forbidden patterns, preferred libraries, commit format, and project-specific shortcuts.",
  "difficulty": "beginner",
  "xpReward": 125,
  "estimatedMinutes": 10,
  "skills": ["behavior-customization", "coding-standards", "claude-md-rules"],

  "setup": {
    "workingDir": "~/dojo-workspace/challenge-07-002",
    "initialFiles": [
      {
        "path": "README.md",
        "content": "# Challenge: Customize Claude's Behavior\n\nLearn to write rules in CLAUDE.md that make Claude Code follow your\nproject's specific conventions and standards.\n\n## How Behavioral Rules Work\n\nClaude Code reads your CLAUDE.md at the start of every session and\ntreats its contents as instructions. When you write \"Always use arrow\nfunctions\", Claude Code will use arrow functions in every piece of\ncode it generates. When you write \"Never use console.log in production\ncode\", Claude Code will avoid it.\n\nThis is powerful because it means you configure once, and every\ninteraction with Claude Code in that project follows your rules\nautomatically. No need to repeat yourself in every prompt.\n\n## Types of Behavioral Rules\n\n### 1. Coding Style Rules\n\nThese tell Claude Code HOW to write code:\n\n```markdown\n## Coding Style\n- Always use arrow functions for callbacks\n- Prefer `const` over `let`; never use `var`\n- Use template literals instead of string concatenation\n- Destructure objects and arrays when possible\n- Use early returns to avoid deep nesting\n```\n\nBe specific. \"Write clean code\" is too vague. \"Use early returns to\navoid nesting deeper than 3 levels\" is actionable.\n\n### 2. Forbidden Patterns\n\nThese tell Claude Code what to AVOID:\n\n```markdown\n## Do Not\n- Never use `any` type in TypeScript\n- Never use `console.log` in production code (use the logger utility)\n- Do not use `moment.js` - use `date-fns` instead\n- Do not use default exports - always use named exports\n- Never mutate function arguments directly\n```\n\nForbidden patterns are especially effective. Claude Code is very good\nat respecting \"never\" and \"do not\" rules. Pair each rule with what\nto do instead.\n\n### 3. Preferred Libraries and Tools\n\nThese prevent Claude Code from suggesting alternatives:\n\n```markdown\n## Libraries\n- HTTP requests: use `axios` (not fetch)\n- Date handling: use `date-fns` (not moment.js)\n- Validation: use `zod` (not joi or yup)\n- Testing: use `vitest` (not jest)\n- State management: use `zustand` (not redux)\n```\n\nWithout these rules, Claude Code might suggest any popular library.\nWith them, it consistently uses what your project already depends on.\n\n### 4. Commit Message Format\n\nStandardize how Claude Code writes commit messages:\n\n```markdown\n## Git Conventions\n- Use conventional commits: type(scope): description\n- Types: feat, fix, docs, style, refactor, test, chore\n- Keep subject line under 72 characters\n- Use imperative mood: \"Add feature\" not \"Added feature\"\n- Example: `feat(auth): add JWT token refresh endpoint`\n```\n\n### 5. Command Shortcuts\n\nDocument project-specific commands so Claude Code uses them:\n\n```markdown\n## Commands\n- `npm run dev` - Start dev server on port 3000\n- `npm run test:watch` - Run tests in watch mode\n- `npm run db:migrate` - Run database migrations\n- `npm run db:seed` - Seed database with test data\n- `npm run lint:fix` - Auto-fix linting issues\n```\n\nWhen you ask Claude Code to \"run the tests\", it will use the exact\ncommand from your CLAUDE.md instead of guessing.\n\n## Writing Effective Rules\n\n**Good rules are:**\n- Specific and actionable (\"Use date-fns for date formatting\")\n- Paired with reasoning when not obvious (\"Use named exports so\n  tree-shaking works correctly\")\n- Organized under clear headers\n\n**Bad rules are:**\n- Vague (\"Write good code\")\n- Contradictory (\"Always use const\" + \"Use let for all variables\")\n- Redundant with language defaults\n\n## Your Task\n\nThis workspace has a Node.js/Express API project. The team has decided\non specific conventions. Your job is to create a CLAUDE.md that\nencodes these conventions so Claude Code follows them automatically:\n\n1. **TypeScript is required** - all new files must be .ts\n2. **Error handling** - all async route handlers must use try/catch\n3. **No `any` type** - always use proper types or `unknown`\n4. **Use `const` and arrow functions** - no `var`, no `function` keyword for callbacks\n5. **Conventional commits** - feat:, fix:, docs:, etc.\n6. **Use `zod` for validation** - not joi, not manual validation\n7. **Named exports only** - no default exports\n\nCreate CLAUDE.md with organized sections that capture all of these.\n"
      },
      {
        "path": "package.json",
        "content": "{\n  \"name\": \"inventory-api\",\n  \"version\": \"2.1.0\",\n  \"scripts\": {\n    \"dev\": \"tsx watch src/index.ts\",\n    \"build\": \"tsc\",\n    \"start\": \"node dist/index.js\",\n    \"test\": \"vitest\",\n    \"test:watch\": \"vitest --watch\",\n    \"lint\": \"eslint src/ --ext .ts\",\n    \"lint:fix\": \"eslint src/ --ext .ts --fix\",\n    \"db:migrate\": \"prisma migrate dev\",\n    \"db:seed\": \"prisma db seed\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.0\",\n    \"zod\": \"^3.22.0\",\n    \"@prisma/client\": \"^5.0.0\",\n    \"date-fns\": \"^3.0.0\",\n    \"jsonwebtoken\": \"^9.0.0\"\n  },\n  \"devDependencies\": {\n    \"typescript\": \"^5.3.0\",\n    \"tsx\": \"^4.0.0\",\n    \"vitest\": \"^1.0.0\",\n    \"eslint\": \"^8.50.0\",\n    \"prisma\": \"^5.0.0\"\n  }\n}\n"
      },
      {
        "path": "tsconfig.json",
        "content": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"commonjs\",\n    \"strict\": true,\n    \"esModuleInterop\": true,\n    \"outDir\": \"dist\",\n    \"rootDir\": \"src\",\n    \"noImplicitAny\": true\n  },\n  \"include\": [\"src/**/*\"]\n}\n"
      },
      {
        "path": "src/index.ts",
        "content": "import express from 'express';\nimport { itemRoutes } from './routes/items';\nimport { authRoutes } from './routes/auth';\nimport { errorHandler } from './middleware/errorHandler';\nimport { requestLogger } from './middleware/logger';\n\nconst app = express();\n\napp.use(express.json());\napp.use(requestLogger);\napp.use('/api/items', itemRoutes);\napp.use('/api/auth', authRoutes);\napp.use(errorHandler);\n\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(`Server running on port ${PORT}`);\n});\n"
      },
      {
        "path": "src/routes/items.ts",
        "content": "import { Router } from 'express';\nimport { z } from 'zod';\nimport { prisma } from '../lib/prisma';\n\nexport const itemRoutes = Router();\n\nconst createItemSchema = z.object({\n  name: z.string().min(1),\n  quantity: z.number().int().positive(),\n  category: z.string()\n});\n\nitemRoutes.get('/', async (req, res) => {\n  try {\n    const items = await prisma.item.findMany();\n    res.json(items);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to fetch items' });\n  }\n});\n\nitemRoutes.post('/', async (req, res) => {\n  try {\n    const data = createItemSchema.parse(req.body);\n    const item = await prisma.item.create({ data });\n    res.status(201).json(item);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      res.status(400).json({ errors: error.errors });\n    } else {\n      res.status(500).json({ error: 'Failed to create item' });\n    }\n  }\n});\n"
      },
      {
        "path": "src/middleware/errorHandler.ts",
        "content": "import { Request, Response, NextFunction } from 'express';\n\nexport const errorHandler = (\n  err: Error,\n  req: Request,\n  res: Response,\n  _next: NextFunction\n) => {\n  console.error('[Error]', err.message);\n  res.status(500).json({ error: 'Internal server error' });\n};\n"
      }
    ],
    "cleanBefore": true
  },

  "objectives": [
    {
      "id": "obj-1",
      "description": "Create CLAUDE.md (or it already exists and was updated)",
      "type": "file_exists",
      "target": "CLAUDE.md",
      "required": true
    },
    {
      "id": "obj-2",
      "description": "Specify TypeScript as the required language",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "[Tt]ype[Ss]cript|\\.ts",
      "required": true
    },
    {
      "id": "obj-3",
      "description": "Include error handling rules (try/catch for async)",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "try.?catch|[Ee]rror.?handl|async.*try|wrap.*async",
      "required": true
    },
    {
      "id": "obj-4",
      "description": "Forbid the `any` type",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "(any|`any`).*(never|avoid|do not|don't|forbid|prohibit)|[Nn]o.*`?any`?.*type|[Nn]ever.*`?any`?",
      "required": true
    },
    {
      "id": "obj-5",
      "description": "Include commit message conventions (conventional commits)",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "[Cc]onventional|feat:|fix:|docs:|[Cc]ommit.*format|[Cc]ommit.*convention",
      "required": true
    }
  ],

  "bonusObjectives": [
    {
      "id": "bonus-1",
      "description": "Specify zod as the validation library",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "[Zz]od|validation",
      "xpBonus": 25
    },
    {
      "id": "bonus-2",
      "description": "Require named exports over default exports",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "[Nn]amed export|[Nn]o default export|[Aa]void default export",
      "xpBonus": 25
    },
    {
      "id": "bonus-3",
      "description": "Document project commands (npm scripts)",
      "type": "file_contains",
      "target": "CLAUDE.md",
      "pattern": "npm run (dev|test|build|lint)",
      "xpBonus": 25
    }
  ],

  "hints": [
    {
      "level": 1,
      "text": "Think about organizing your rules into categories. Group similar rules together under clear headings. What sections would a developer look for? Coding style, forbidden patterns, git conventions, and available commands are natural groupings.",
      "xpCost": 10
    },
    {
      "level": 2,
      "text": "For each rule, be specific about what TO DO, not just what to avoid. Instead of just 'no any type', write 'Never use the `any` type - use proper types or `unknown` when the type is truly not known.' Pair every 'never' with an alternative.",
      "xpCost": 25
    },
    {
      "level": 3,
      "text": "Ask Claude Code: 'Create a CLAUDE.md for this inventory API with these sections: 1) Project description 2) Coding Style - use const, arrow functions, no var 3) TypeScript Rules - all files must be .ts, never use any type 4) Error Handling - async handlers must use try/catch 5) Libraries - use zod for validation, date-fns for dates 6) Git - conventional commits (feat:, fix:, docs:) 7) Exports - named exports only 8) Commands - list all npm scripts'",
      "xpCost": 50
    }
  ],

  "solution": {
    "approach": "Create a CLAUDE.md with organized sections covering coding style, TypeScript rules, error handling, library preferences, commit conventions, and project commands.",
    "example": "Create CLAUDE.md with behavioral rules organized under clear section headings",
    "alternativeApproaches": [
      "Ask Claude Code to examine the existing code patterns and generate matching rules",
      "Write rules one section at a time, verifying each section is specific and actionable"
    ]
  },

  "learningPoints": [
    "CLAUDE.md rules directly control how Claude Code generates code in your project",
    "Specific rules ('use date-fns, not moment') work better than vague ones ('use good libraries')",
    "Pair every 'never' or 'do not' rule with the preferred alternative",
    "Organize rules under headers so Claude Code can quickly find relevant instructions",
    "Forbidden patterns are highly effective - Claude Code respects 'never' and 'do not' instructions reliably",
    "Document commit message format to get consistent git behavior from Claude Code"
  ],

  "nextChallenge": "07-003"
}