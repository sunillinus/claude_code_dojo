{
  "id": "16-004",
  "module": "plugin-development",
  "title": "Plugin Configuration & Settings",
  "description": "Learn to make plugins configurable using the .local.md pattern. Per-project configuration lets the same plugin behave differently in each project.",
  "difficulty": "intermediate",
  "xpReward": 300,
  "estimatedMinutes": 15,
  "skills": ["plugin-settings", "local-md-pattern", "per-project-config"],

  "setup": {
    "workingDir": "~/dojo-workspace/challenge-16-004",
    "initialFiles": [
      {
        "path": "README.md",
        "content": "# Challenge: Plugin Configuration & Settings\n\nMake a plugin configurable so it adapts to different projects.\n\n---\n\n## The Problem: One Size Does Not Fit All\n\nImagine you build a linting plugin. Project A uses ESLint with tabs\nand 120-character lines. Project B uses Prettier with spaces and\n80-character lines. If your plugin hardcodes \"use ESLint with tabs,\"\nit only works for Project A.\n\nThe solution is **per-project configuration**: each project tells the\nplugin how to behave via a configuration file.\n\n## The .local.md Pattern\n\nClaude Code plugins use `.local.md` files for per-project settings.\nThe convention is:\n\n```\n.claude/<plugin-name>.local.md\n```\n\nFor a plugin named `code-formatter`, the config file would be:\n```\n.claude/code-formatter.local.md\n```\n\nThis file lives in the PROJECT's `.claude/` directory, not in the\nplugin itself. Each project that uses the plugin can have its own\nconfig file with different settings.\n\n## Anatomy of a .local.md File\n\nA `.local.md` file has two parts: YAML frontmatter for structured\nsettings and a markdown body for free-form notes.\n\n```markdown\n---\nlinter: eslint\nindentStyle: tabs\nindentSize: 4\nmaxLineLength: 120\nignorePatterns:\n  - \"*.min.js\"\n  - \"dist/**\"\n---\n\n## Project-Specific Notes\n\nThis project uses ESLint with the Airbnb config. We prefer tabs for\naccessibility reasons. The dist/ folder contains generated code and\nshould be excluded from linting.\n\n### Exceptions\n- Test files can use longer lines (up to 150 chars)\n- Generated migration files are excluded from all checks\n```\n\n### YAML Frontmatter: Structured Settings\n\nThe frontmatter between `---` markers holds key-value pairs that your\nplugin can read and act on:\n\n```yaml\n---\nlinter: eslint            # Which linter to use\nindentStyle: tabs          # tabs or spaces\nindentSize: 4              # Number of spaces (or tab width)\nmaxLineLength: 120         # Maximum characters per line\n---\n```\n\nThese are machine-readable settings. Your skill instructions can say\n\"read the configuration and use the specified linter\" and Claude will\nparse these values.\n\n### Markdown Body: Free-form Notes\n\nThe body below the frontmatter is free-form markdown. Use it for:\n- Project-specific context that Claude should know\n- Exceptions to the general rules\n- Explanations of why certain settings were chosen\n- Links to project documentation\n\nClaude reads the entire file, so both the structured frontmatter and\nthe free-form notes inform its behavior.\n\n## Why .local.md Should Be in .gitignore\n\nThe `.local.md` file contains project-specific settings that may vary\nper developer or environment. Add it to `.gitignore`:\n\n```\n# .gitignore\n.claude/*.local.md\n```\n\nInstead, provide a `.local.md.template` file IN YOUR PLUGIN that shows\nusers what settings are available and what values they can use. Users\ncopy this template to their project's `.claude/` directory and\ncustomize it.\n\n## How Skills Read Configuration\n\nSkills reference configuration using `${CLAUDE_PLUGIN_ROOT}` and\ninstructions to read the .local.md file. Here is the pattern:\n\n```markdown\n---\ndescription: Format code according to project settings\nallowedTools: Bash, Read, Glob\n---\n\nBefore formatting, read the project configuration:\n\n1. Check if `.claude/code-formatter.local.md` exists in the project\n2. If it exists, read it and use the settings from the frontmatter:\n   - `linter`: which formatter to run\n   - `indentStyle`: tabs or spaces\n   - `indentSize`: indentation width\n   - `maxLineLength`: line length limit\n3. If no config file exists, use sensible defaults:\n   - linter: prettier\n   - indentStyle: spaces\n   - indentSize: 2\n   - maxLineLength: 80\n\n## Formatting Steps\n1. Read the configuration (or use defaults)\n2. Detect source files in the project\n3. Run the configured formatter with the specified settings\n4. Report what was formatted and any issues found\n```\n\nThe key insight: the skill INSTRUCTS Claude to read the config file.\nClaude is the one doing the reading, not the plugin framework. This\nmeans your instructions need to clearly describe what to read and\nhow to interpret the values.\n\n## A Complete Example\n\nHere is a full example of a configurable plugin:\n\n**Plugin manifest** (`plugin.json`):\n```json\n{\n  \"name\": \"code-formatter\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Configurable code formatting with per-project settings\"\n}\n```\n\n**Config template** (`code-formatter.local.md.template`):\n```markdown\n---\nlinter: prettier\nindentStyle: spaces\nindentSize: 2\nmaxLineLength: 80\n---\n\n## Configuration Guide\n\n### linter\nWhich formatter to use. Options: `prettier`, `eslint`, `black`, `gofmt`\n\n### indentStyle\nIndentation type. Options: `tabs`, `spaces`\n\n### indentSize\nWidth of indentation. Common values: `2`, `4`\n\n### maxLineLength\nMaximum characters per line. Common values: `80`, `100`, `120`\n```\n\n**Skill** (`skills/format/SKILL.md`):\n```markdown\n---\ndescription: Format code using project-specific settings\nallowedTools: Bash, Read, Glob\n---\n\nFormat code according to the project's configuration.\n\n## Step 1: Read Configuration\nCheck for `.claude/code-formatter.local.md` in the current project.\nIf found, use the settings from its YAML frontmatter. If not found,\nuse these defaults: prettier, spaces, 2, 80.\n\n## Step 2: Format\nRun the configured formatter on the specified files.\n\n## Step 3: Report\nList files formatted and any issues encountered.\n```\n\n---\n\n## Your Task\n\nBuild a configurable plugin called `code-formatter`. You need:\n\n1. A `plugin.json` manifest (already provided)\n2. A `.local.md` template showing available settings with documentation\n3. A skill that reads the configuration and acts on it\n\nThe template should document all available settings so users know what\noptions they have. The skill should instruct Claude to read the config\nfile and use its values.\n\n## Objectives\n1. Create a config template file (code-formatter.local.md.template)\n2. Template has YAML frontmatter with settings\n3. Template documents what each setting does\n4. Create a skill that references the .local.md configuration\n"
      },
      {
        "path": "plugin.json",
        "content": "{\n  \"name\": \"code-formatter\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Configurable code formatting with per-project settings\"\n}\n"
      }
    ],
    "cleanBefore": true
  },

  "objectives": [
    {
      "id": "obj-1",
      "description": "Create a config template file",
      "type": "file_exists",
      "target": "code-formatter.local.md.template",
      "required": true
    },
    {
      "id": "obj-2",
      "description": "Template has YAML frontmatter between --- markers",
      "type": "file_contains",
      "target": "code-formatter.local.md.template",
      "pattern": "---",
      "required": true
    },
    {
      "id": "obj-3",
      "description": "Template defines configurable settings (linter, indent, style, etc.)",
      "type": "file_contains",
      "target": "code-formatter.local.md.template",
      "pattern": "indent|style|linter|format|tab|space|line.?[Ll]ength",
      "required": true
    },
    {
      "id": "obj-4",
      "description": "Template documents what each setting does",
      "type": "file_contains",
      "target": "code-formatter.local.md.template",
      "pattern": "[Oo]ption|[Dd]efault|[Vv]alue|[Dd]escription|[Gg]uide|[Cc]hoose|[Ss]et",
      "required": true
    },
    {
      "id": "obj-5",
      "description": "Create a skill that references the .local.md configuration",
      "type": "file_contains",
      "target": "skills/format/SKILL.md",
      "pattern": "\\.local\\.md|config|setting|\\.claude/",
      "required": true
    }
  ],

  "bonusObjectives": [
    {
      "id": "bonus-1",
      "description": "Skill has frontmatter with description and allowedTools",
      "type": "file_contains",
      "target": "skills/format/SKILL.md",
      "pattern": "description:",
      "xpBonus": 30
    },
    {
      "id": "bonus-2",
      "description": "Skill defines fallback defaults when no config file exists",
      "type": "file_contains",
      "target": "skills/format/SKILL.md",
      "pattern": "[Dd]efault|[Ff]allback|not found|does not exist|no config",
      "xpBonus": 50
    },
    {
      "id": "bonus-3",
      "description": "Template includes multiple settings (at least 3 frontmatter keys)",
      "type": "command_output_contains",
      "command": "awk '/^---$/{n++; next} n==1{print}' ~/dojo-workspace/challenge-16-004/code-formatter.local.md.template 2>/dev/null | grep -c ':'",
      "pattern": "[3-9]",
      "xpBonus": 40
    }
  ],

  "hints": [
    {
      "level": 1,
      "text": "You need two files: (1) code-formatter.local.md.template with YAML frontmatter containing settings and markdown body documenting them, and (2) skills/format/SKILL.md with a prompt that tells Claude to read .claude/code-formatter.local.md for project settings. The template is what users copy to their project; the skill is what reads it.",
      "xpCost": 20
    },
    {
      "level": 2,
      "text": "For the template, use frontmatter keys like 'linter', 'indentStyle', 'indentSize', 'maxLineLength' with example values. In the markdown body, explain each setting and list valid options. For the skill, write instructions that say: first check if .claude/code-formatter.local.md exists, then read its settings, otherwise use defaults.",
      "xpCost": 60
    },
    {
      "level": 3,
      "text": "Create code-formatter.local.md.template with frontmatter (linter: prettier, indentStyle: spaces, indentSize: 2, maxLineLength: 80) and body sections explaining each setting with options. Create skills/format/SKILL.md with frontmatter (description: 'Format code using project settings', allowedTools: Bash, Read, Glob) and body that instructs Claude to: (1) read .claude/code-formatter.local.md, (2) use settings from frontmatter or defaults if missing, (3) run the configured formatter, (4) report results.",
      "xpCost": 115
    }
  ],

  "solution": {
    "approach": "Create a .local.md template with documented settings in YAML frontmatter, then create a skill that instructs Claude to read the config file and apply the settings with fallback defaults.",
    "example": "Create code-formatter.local.md.template with settings documentation and skills/format/SKILL.md that reads the config",
    "alternativeApproaches": [
      "Make the formatter customizable via a settings template and a config-aware skill",
      "Add per-project configuration support using the .local.md pattern"
    ]
  },

  "learningPoints": [
    "The .local.md pattern stores per-project plugin settings in .claude/<plugin-name>.local.md",
    "YAML frontmatter holds structured key-value settings; the markdown body holds free-form notes and documentation",
    "The plugin provides a .local.md.template file; users copy it to their project's .claude/ directory and customize",
    ".local.md files should be in .gitignore because they contain project-specific or developer-specific settings",
    "Skills read configuration by instructing Claude to check for and parse the .local.md file",
    "Always define fallback defaults in the skill so the plugin works even without a config file"
  ],

  "nextChallenge": "16-005"
}
